

<!DOCTYPE html>
<html class="no-js" lang="en" style="visibility: hidden;">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             Adjusting code to changes in deserialization API introduced in 0.15 | ScyllaDB Docs 
        </title>
        <meta name="description" content="Scylla Driver for Rust." />
        <link rel="icon" href="../_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="../_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="../_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="../_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="../_static/img/favicon-228x228.png" />

        
            
            
        

        
            
            <link rel="canonical" href="https://rust-driver.docs.scylladb.com/stable/migration-guides/0.15-deserialization.html"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
              href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
              href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                  href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>
        
            
                <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/css/main.css?v=a77d7859" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css?v=226d88b4" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
            
        
    
        
        
            
        <script type="text/javascript" src="../_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="../_static/js/main.bundle.js"></script>
        
            
                <script src="../_static/documentation_options.js?v=5929fcd5"></script>
            
        
            
                <script src="../_static/doctools.js?v=9a2dae69"></script>
            
        
            
                <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
            
        
            
                <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
            
        
            
                <script src="../_static/copybutton.js?v=f281be69"></script>
            
        
    
            
                <!-- Local meta tags -->
            
            
                <!-- Google Tag Manager docs -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-54NWVS4");
</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager global -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
            
        
    </head>

    <body>
        <section class="promo-banner  promo-banner--hide" style="display: none;">
    <div class="promo-banner-wrapper">
        
        <div class="promo-banner__title">ScyllaDB University Live | Free Virtual Training Event</div>
        <a class="promo-banner__button button button--reverse" href="#"
           target="_blank" rel="noopener noreferrer">Learn more</a>
        <button class="promo-banner__close">
            <i class="icon-cancel"></i>
        </button>
    </div>
</section>
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="../_static/img/scylladb-logo-horizontal.svg" alt="ScyllaDB Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Server
                    <i class="chevron icon-arrow-dropdown"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://opensource.docs.scylladb.com/">
                            <i class="icon-docs-open-source"></i>
                            ScyllaDB Open Source
                        </a>
                    </li>
                    <li>
                        <a href="https://enterprise.docs.scylladb.com/">
                            <i class="icon-docs-enterprise"></i>ScyllaDB Enterprise
                        </a>
                    </li>
                    <li>
                        <a href="https://scylla.docs.scylladb.com/stable/alternator/alternator.html">
                            <i class="icon-docs-alternator"></i>
                            ScyllaDB Alternator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="https://docs.scylladb.com/scylla-cloud/" class="scylla-dropdown__title">Cloud</a>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i class="chevron icon-arrow-dropdown"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="icon-docs-manager"></i>ScyllaDB Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="icon-docs-monitoring"></i>ScyllaDB
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="icon-docs-operator"></i>ScyllaDB Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i class="chevron icon-arrow-dropdown"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/">
                            <i class="icon-docs-nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/">
                            <i class="icon-docs-alternator"></i>DynamoDB Drivers
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://www.scylladb.com/download/" class="button">Download</a>
        </div>
    </div>
    <div class="header-search-box">
        <i class="dark-theme-toggler icon-theme"></i>
        <div class="search-box">
            <ci-search></ci-search>
        </div>
    </div>
    <div class="side-nav-toggle">
    <i class="dark-theme-toggler icon-theme"></i>
    <div class="side-nav-toggle__button" data-toggle="side-nav">
        <i class="icon-menu"></i>
    </div>
</div>
</header>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    
    <div class="admonition caution">
        <p class="admonition-title">Caution</p>
        <p>
            
                You're viewing documentation for an unstable version of Scylla Rust Driver.
            
            <a href="../../stable/index.html">Switch to the latest stable version.</a>
        </p>
    </div>

                
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://docs.scylladb.com"
           class="bread__highlight">
            <i class="icon-home"></i> ScyllaDB Docs
        </a>
    </span>
    <span class="bread__item">
        <a href="https://rust-driver.docs.scylladb.com"
           class="bread__highlight">
            Scylla Rust Driver
        </a>
    </span>
    
        <span class="bread__item">
            <a href="migration-guides.html" class="bread__highlight">
                Migration guides
            </a>
        </span>
    
    <span class="bread__item bread__item--last">Adjusting code to changes in deserialization API introduced in 0.15</span>
</div>
                    </div>
                
                <section id="adjusting-code-to-changes-in-deserialization-api-introduced-in-0-15">
<h1>Adjusting code to changes in deserialization API introduced in 0.15<a class="headerlink" href="#adjusting-code-to-changes-in-deserialization-api-introduced-in-0-15" title="Link to this heading">¶</a></h1>
<p>In 0.15, a new deserialization API has been introduced. The new API improves type safety and performance of the old one, so it is highly recommended to switch to it. However, deserialization is an area of the API that users frequently interact with: deserialization traits appear in generic code and custom implementations have been written. In order to make migration easier, the driver still offers the old API, which - while opt-in - can be very easily switched to after version upgrade. Furthermore, a number of facilities have been introduced which help migrate the user code to the new API piece-by-piece.</p>
<p>The old API and migration facilities will be removed in a future major release.</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<section id="old-traits">
<h3>Old traits<a class="headerlink" href="#old-traits" title="Link to this heading">¶</a></h3>
<p>The legacy API works by deserializing rows in the query response to a sequence of <code class="docutils literal notranslate"><span class="pre">Row</span></code>s. The <code class="docutils literal notranslate"><span class="pre">Row</span></code> is just a <code class="docutils literal notranslate"><span class="pre">Vec&lt;Option&lt;CqlValue&gt;&gt;</span></code>, where <code class="docutils literal notranslate"><span class="pre">CqlValue</span></code> is an enum that is able to represent any CQL value.</p>
<p>The user can request this type-erased representation to be converted into something useful. There are two traits that power this:</p>
<p><strong><code class="docutils literal notranslate"><span class="pre">FromRow</span></code></strong></p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">FromRow</span><span class="p">:</span><span class="w"> </span><span class="nb">Sized</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">from_row</span><span class="p">(</span><span class="n">row</span><span class="p">:</span><span class="w"> </span><span class="nc">Row</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="n">FromRowError</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong><code class="docutils literal notranslate"><span class="pre">FromCqlVal</span></code></strong></p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// The `T` parameter is supposed to be either `CqlValue` or `Option&lt;CqlValue&gt;`</span>
<span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">FromCqlVal</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">:</span><span class="w"> </span><span class="nb">Sized</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">from_cql</span><span class="p">(</span><span class="n">cql_val</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="n">FromCqlValError</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These traits are implemented for some common types:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FromRow</span></code> is implemented for tuples up to 16 elements,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FromCqlVal</span></code> is implemented for a bunch of types, and each CQL type can be converted to one of them.</p></li>
</ul>
<p>While it’s possible to implement those manually, the driver provides procedural macros for automatic derivation in some cases:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FromRow</span></code> - implements <code class="docutils literal notranslate"><span class="pre">FromRow</span></code> for a struct.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FromUserType</span></code> - generated an implementation of <code class="docutils literal notranslate"><span class="pre">FromCqlVal</span></code> for the struct, trying to parse the CQL value as a UDT.</p></li>
</ul>
<p>Note: the macros above have a default behavior that is different than what <code class="docutils literal notranslate"><span class="pre">FromRow</span></code> and <code class="docutils literal notranslate"><span class="pre">FromUserType</span></code> do.</p>
</section>
<section id="new-traits">
<h3>New traits<a class="headerlink" href="#new-traits" title="Link to this heading">¶</a></h3>
<p>The new API introduce two analogous traits that, instead of consuming pre-parsed <code class="docutils literal notranslate"><span class="pre">Vec&lt;Option&lt;CqlValue&gt;&gt;</span></code>, are given raw, serialized data with full information about its type. This leads to better performance and allows for better type safety.</p>
<p>The new traits are:</p>
<p><strong><code class="docutils literal notranslate"><span class="pre">DeserializeRow&lt;'frame,</span> <span class="pre">'metadata&gt;</span></code></strong></p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">DeserializeRow</span><span class="o">&lt;&#39;</span><span class="na">frame</span><span class="p">,</span><span class="w"> </span><span class="o">&#39;</span><span class="na">metadata</span><span class="o">&gt;</span>
<span class="k">where</span>
<span class="w">    </span><span class="bp">Self</span><span class="p">:</span><span class="w"> </span><span class="nb">Sized</span><span class="p">,</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">type_check</span><span class="p">(</span><span class="n">specs</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="p">[</span><span class="n">ColumnSpec</span><span class="p">])</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">TypeCheckError</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="n">row</span><span class="p">:</span><span class="w"> </span><span class="nc">ColumnIterator</span><span class="o">&lt;&#39;</span><span class="na">frame</span><span class="p">,</span><span class="w"> </span><span class="o">&#39;</span><span class="na">metadata</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="n">DeserializationError</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong><code class="docutils literal notranslate"><span class="pre">DeserializeValue&lt;'frame,</span> <span class="pre">'metadata&gt;</span></code></strong></p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">DeserializeValue</span><span class="o">&lt;&#39;</span><span class="na">frame</span><span class="p">,</span><span class="w"> </span><span class="o">&#39;</span><span class="na">metadata</span><span class="o">&gt;</span>
<span class="k">where</span>
<span class="w">    </span><span class="bp">Self</span><span class="p">:</span><span class="w"> </span><span class="nb">Sized</span><span class="p">,</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">type_check</span><span class="p">(</span><span class="n">typ</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">ColumnType</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">TypeCheckError</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span>
<span class="w">        </span><span class="n">typ</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">metadata</span><span class="w"> </span><span class="nc">ColumnType</span><span class="o">&lt;&#39;</span><span class="na">metadata</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">        </span><span class="n">v</span><span class="p">:</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">FrameSlice</span><span class="o">&lt;&#39;</span><span class="na">frame</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="n">DeserializationError</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above traits have been implemented for the same set of types as <code class="docutils literal notranslate"><span class="pre">FromRow</span></code> and <code class="docutils literal notranslate"><span class="pre">FromCqlVal</span></code>, respectively. Notably, <code class="docutils literal notranslate"><span class="pre">DeserializeRow</span></code> is implemented for <code class="docutils literal notranslate"><span class="pre">Row</span></code>, and <code class="docutils literal notranslate"><span class="pre">DeserializeValue</span></code> is implemented for <code class="docutils literal notranslate"><span class="pre">CqlValue</span></code>.</p>
<p>There are also <code class="docutils literal notranslate"><span class="pre">DeserializeRow</span></code> and <code class="docutils literal notranslate"><span class="pre">DeserializeValue</span></code> derive macros, analogous to <code class="docutils literal notranslate"><span class="pre">FromRow</span></code> and <code class="docutils literal notranslate"><span class="pre">FromUserType</span></code>, respectively - but with slightly different defaults (explained later in this doc page).</p>
</section>
</section>
<section id="updating-the-code-to-use-the-new-api">
<h2>Updating the code to use the new API<a class="headerlink" href="#updating-the-code-to-use-the-new-api" title="Link to this heading">¶</a></h2>
<p>Some of the core types have been updated to use the new traits. Updating the code to use the new API should be straightforward.</p>
<section id="basic-queries">
<h3>Basic queries<a class="headerlink" href="#basic-queries" title="Link to this heading">¶</a></h3>
<p>Sending queries with the single page API should work similarly as before. The <code class="docutils literal notranslate"><span class="pre">Session::query_{unpaged,single_page}</span></code>, <code class="docutils literal notranslate"><span class="pre">Session::execute_{unpaged,single_page}</span></code> and <code class="docutils literal notranslate"><span class="pre">Session::batch</span></code> functions have the same interface as before, the only exception being that they return a new, updated <code class="docutils literal notranslate"><span class="pre">QueryResult</span></code>.</p>
<p>Consuming rows from a result will require only minimal changes if you are using helper methods of the <code class="docutils literal notranslate"><span class="pre">QueryResult</span></code>. Now, there is no distinction between “typed” and “non-typed” methods; all methods that return rows need to have the type specified. For example, previously there used to be both <code class="docutils literal notranslate"><span class="pre">rows(self)</span></code> and <code class="docutils literal notranslate"><span class="pre">rows_typed&lt;RowT:</span> <span class="pre">FromRow&gt;(self)</span></code>, now there is only a single <code class="docutils literal notranslate"><span class="pre">rows&lt;R:</span> <span class="pre">DeserializeRow&lt;'frame,</span> <span class="pre">'metadata&gt;&gt;(&amp;self)</span></code>. Another thing worth mentioning is that the returned iterator now <em>borrows</em> from the <code class="docutils literal notranslate"><span class="pre">QueryResult</span></code> instead of consuming it.</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">QueryResult::rows</span></code> field is not available anymore. If you used to access it directly, you need to change your code to use the helper methods instead.</p>
<p>Before:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span>
<span class="w">    </span><span class="p">.</span><span class="n">query_unpaged</span><span class="p">(</span><span class="s">&quot;SELECT name, age FROM my_keyspace.people&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[])</span>
<span class="w">    </span><span class="p">.</span><span class="k">await</span><span class="o">?</span>
<span class="w">    </span><span class="p">.</span><span class="n">rows_typed</span><span class="p">::</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="o">&gt;</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{} has age {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// 1. Note that the result must be converted to a rows result, and only then</span>
<span class="c1">// an iterator created.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span>
<span class="w">    </span><span class="p">.</span><span class="n">query_unpaged</span><span class="p">(</span><span class="s">&quot;SELECT name, age FROM my_keyspace.people&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[])</span>
<span class="w">    </span><span class="p">.</span><span class="k">await</span><span class="o">?</span>
<span class="w">    </span><span class="p">.</span><span class="n">into_rows_result</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>

<span class="c1">// 2. Note that `rows` is used here, not `rows_typed`.</span>
<span class="c1">// 3. Note that the new deserialization framework support deserializing types</span>
<span class="c1">//    that borrow directly from the result frame; let&#39;s use them to avoid</span>
<span class="c1">//    needless allocations.</span>
<span class="k">for</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">rows</span><span class="p">::</span><span class="o">&lt;</span><span class="p">(</span><span class="o">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="o">&gt;</span><span class="p">()</span><span class="o">?</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{} has age {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="iterator-queries">
<h3>Iterator queries<a class="headerlink" href="#iterator-queries" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Session::query_iter</span></code> and <code class="docutils literal notranslate"><span class="pre">Session::execute_iter</span></code> have been adjusted, too. They now return a <code class="docutils literal notranslate"><span class="pre">QueryPager</span></code> - an intermediate object which needs to be converted into <code class="docutils literal notranslate"><span class="pre">TypedRowStream</span></code> first before being actually iterated over.</p>
<p>Before:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">rows_stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span>
<span class="w">    </span><span class="p">.</span><span class="n">query_iter</span><span class="p">(</span><span class="s">&quot;SELECT name, age FROM my_keyspace.people&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[])</span>
<span class="w">    </span><span class="p">.</span><span class="k">await</span><span class="o">?</span>
<span class="w">    </span><span class="p">.</span><span class="n">into_typed</span><span class="p">::</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="o">&gt;</span><span class="p">();</span>

<span class="k">while</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">next_row_res</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rows_stream</span><span class="p">.</span><span class="n">next</span><span class="p">().</span><span class="k">await</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">):</span><span class="w"> </span><span class="p">(</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_row_res</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;a, b: {}, {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">rows_stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span>
<span class="w">    </span><span class="p">.</span><span class="n">query_iter</span><span class="p">(</span><span class="s">&quot;SELECT name, age FROM my_keyspace.people&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[])</span>
<span class="w">    </span><span class="p">.</span><span class="k">await</span><span class="o">?</span>
<span class="w">    </span><span class="c1">// The type of the TypedRowStream is inferred from further use of it.</span>
<span class="w">    </span><span class="c1">// Alternatively, it can be specified using turbofish syntax:</span>
<span class="w">    </span><span class="c1">// .rows_stream::&lt;(String, i32)&gt;()?;</span>
<span class="w">    </span><span class="p">.</span><span class="n">rows_stream</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>

<span class="k">while</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">next_row_res</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rows_stream</span><span class="p">.</span><span class="n">next</span><span class="p">().</span><span class="k">await</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">):</span><span class="w"> </span><span class="p">(</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_row_res</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;a, b: {}, {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Currently, <code class="docutils literal notranslate"><span class="pre">QueryPager</span></code>/<code class="docutils literal notranslate"><span class="pre">TypedRowStream</span></code> do not support deserialization of borrowed types due to limitations of Rust with regard to lending streams. If you want to deserialize borrowed types not to incur additional allocations, use manual paging (<code class="docutils literal notranslate"><span class="pre">{query/execute}_single_page</span></code>) API.</p>
</section>
<section id="procedural-macros">
<h3>Procedural macros<a class="headerlink" href="#procedural-macros" title="Link to this heading">¶</a></h3>
<p>As mentioned in the Introduction section, the driver provides new procedural macros for the <code class="docutils literal notranslate"><span class="pre">DeserializeRow</span></code> and <code class="docutils literal notranslate"><span class="pre">DeserializeValue</span></code> traits that are meant to replace <code class="docutils literal notranslate"><span class="pre">FromRow</span></code> and <code class="docutils literal notranslate"><span class="pre">FromUserType</span></code>, respectively. The new macros are designed to be slightly more type-safe by matching column/UDT field names to rust field names dynamically. This is a different behavior to what the old macros used to do, but the new macros can be configured with <code class="docutils literal notranslate"><span class="pre">#[attributes]</span></code> to simulate the old behavior.</p>
<p><strong><code class="docutils literal notranslate"><span class="pre">FromRow</span></code> vs. <code class="docutils literal notranslate"><span class="pre">DeserializeRow</span></code></strong></p>
<p>The impl generated by <code class="docutils literal notranslate"><span class="pre">FromRow</span></code> expects columns to be in the same order as the struct fields. The <code class="docutils literal notranslate"><span class="pre">FromRow</span></code> trait does not have information about column names, so it cannot match them with the struct field names. You can use <code class="docutils literal notranslate"><span class="pre">enforce_order</span></code> and <code class="docutils literal notranslate"><span class="pre">skip_name_checks</span></code> attributes to achieve such behavior via <code class="docutils literal notranslate"><span class="pre">DeserializeRow</span></code> trait.</p>
<p><strong><code class="docutils literal notranslate"><span class="pre">FromUserType</span></code> vs. <code class="docutils literal notranslate"><span class="pre">DeserializeValue</span></code></strong></p>
<p>The impl generated by <code class="docutils literal notranslate"><span class="pre">FromUserType</span></code> expects UDT fields to be in the same order as the struct fields. Field names should be the same both in the UDT and in the struct. You can use the <code class="docutils literal notranslate"><span class="pre">enforce_order</span></code> attribute to achieve such behavior via the <code class="docutils literal notranslate"><span class="pre">DeserializeValue</span></code> trait.</p>
</section>
<section id="adjusting-custom-impls-of-deserialization-traits">
<h3>Adjusting custom impls of deserialization traits<a class="headerlink" href="#adjusting-custom-impls-of-deserialization-traits" title="Link to this heading">¶</a></h3>
<p>If you have a custom type with a hand-written <code class="docutils literal notranslate"><span class="pre">impl</span> <span class="pre">FromRow</span></code> or <code class="docutils literal notranslate"><span class="pre">impl</span> <span class="pre">FromCqlVal</span></code>, the best thing to do is to just write a new impl for <code class="docutils literal notranslate"><span class="pre">DeserializeRow</span></code> or <code class="docutils literal notranslate"><span class="pre">DeserializeValue</span></code> manually. Although it’s technically possible to implement the new traits by using the existing implementation of the old ones, rolling out a new implementation will avoid performance problems related to the inefficient <code class="docutils literal notranslate"><span class="pre">CqlValue</span></code> representation.</p>
</section>
</section>
<section id="accessing-the-old-api">
<h2>Accessing the old API<a class="headerlink" href="#accessing-the-old-api" title="Link to this heading">¶</a></h2>
<p>Most important types related to deserialization of the old API have been renamed and contain a <code class="docutils literal notranslate"><span class="pre">Legacy</span></code> prefix in their names:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Session</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">LegacySession</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CachingSession</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">LegacyCachingSession</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RowIterator</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">LegacyRowIterator</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TypedRowIterator</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">LegacyTypedRowIterator</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QueryResult</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">LegacyQueryResult</span></code></p></li>
</ul>
<p>If you intend to quickly migrate your application by using the old API, you can just import the legacy stuff and alias it as the new one, e.g.:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">scylla</span><span class="p">::</span><span class="n">LegacySession</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Session</span><span class="p">;</span>
</pre></div>
</div>
<p>In order to create the <code class="docutils literal notranslate"><span class="pre">LegacySession</span></code> instead of the new <code class="docutils literal notranslate"><span class="pre">Session</span></code>, you need to use <code class="docutils literal notranslate"><span class="pre">SessionBuilder</span></code>’s <code class="docutils literal notranslate"><span class="pre">build_legacy()</span></code> method instead of <code class="docutils literal notranslate"><span class="pre">build()</span></code>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">session</span><span class="p">:</span><span class="w"> </span><span class="nc">LegacySession</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SessionBuilder</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="n">known_node</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">build_legacy</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="k">await</span><span class="o">?</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="mixing-the-old-and-the-new-api">
<h2>Mixing the old and the new API<a class="headerlink" href="#mixing-the-old-and-the-new-api" title="Link to this heading">¶</a></h2>
<p>It is possible to use different APIs in different parts of the program. The <code class="docutils literal notranslate"><span class="pre">Session</span></code> allows to create a <code class="docutils literal notranslate"><span class="pre">LegacySession</span></code> object that has the old API but shares all resources with the session that has the new API (and vice versa - you can create a new API session from the old API session).</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// All of the session objects below will use the same resources: connections,</span>
<span class="c1">// metadata, current keyspace, etc.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">old_api_session</span><span class="p">:</span><span class="w"> </span><span class="nc">LegacySession</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_api_session</span><span class="p">.</span><span class="n">make_shared_session_with_legacy_api</span><span class="p">();</span>
<span class="kd">let</span><span class="w"> </span><span class="n">another_new_api_session</span><span class="p">:</span><span class="w"> </span><span class="nc">Session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">old_api_session</span><span class="p">.</span><span class="n">make_shared_session_with_new_api</span><span class="p">();</span>
</pre></div>
</div>
<p>In addition to that, it is possible to convert a <code class="docutils literal notranslate"><span class="pre">QueryResult</span></code> to <code class="docutils literal notranslate"><span class="pre">LegacyQueryResult</span></code>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="nc">QueryResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="kd">let</span><span class="w"> </span><span class="n">legacy_result</span><span class="p">:</span><span class="w"> </span><span class="nc">LegacyQueryResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">into_legacy_result</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</pre></div>
</div>
<p>… and <code class="docutils literal notranslate"><span class="pre">QueryPager</span></code> into <code class="docutils literal notranslate"><span class="pre">LegacyRowIterator</span></code>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="n">pager</span><span class="p">:</span><span class="w"> </span><span class="nc">QueryPager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pager</span><span class="p">;</span>
<span class="kd">let</span><span class="w"> </span><span class="n">legacy_result</span><span class="p">:</span><span class="w"> </span><span class="nc">LegacyRowIterator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pager</span><span class="p">.</span><span class="n">into_legacy</span><span class="p">();</span>
</pre></div>
</div>
</section>
</section>

                
                    <div class="post-content">
                        
    <div class="feedback-container">
        <p class="feedback-container__title">Was this page helpful?</p>
        <span data-tooltip tabindex="1" title="Yes" data-position="top">
            <button class="feedback-container__button" id="feedback-positive">
                <i class="feedback-container__icon icon-docs-thumbs-up"></i>
            </button>
        </span>
        <span data-tooltip tabindex="1" title="No" data-position="top">
            <button class="feedback-container__button" id="feedback-negative">
                <i class="feedback-container__icon icon-docs-thumbs-down"></i>
            </button>
        </span>
        <div class="feedback-container__message" id="feedback-message"></div>
    </div>

    <script>
        function resetFeedbackButtonActive() {
            const feedbackButtons = document.getElementsByClassName('feedback-container__button');
            for (let i = 0; i < feedbackButtons.length; i++) {
                feedbackButtons[i].classList.remove('active');
            }
        }

        function showMessage(liked) {
            const feedbackMessage = document.getElementById('feedback-message');
            const themeGithubRepository = true;
            let message = 'Great! Thanks for your feedback.';
            if (themeGithubRepository && !liked) {
                message = "Thanks for your feedback! Please don't hesitate to <a href='https://github.com/scylladb/scylla-rust-driver/issues/new?title=docs:%20Issue on page Adjusting code to changes in deserialization API introduced in 0.15&&body=I%20would%20like%20to%20report%20an%20issue%20on%20page%20https://rust-driver.docs.scylladb.com/main/migration-guides/0.15-deserialization%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix&labels=documentation'>create an issue</a> if you have any suggestions on how we can improve.";
            }
            feedbackMessage.innerHTML = message;
        }

        function sendGaEvent(liked) {
            const event_label = liked ? "positive" : "negative";
            const event = "feedback_" + event_label;
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                'event': event,
            });
        }

        const positiveFeebackButton = document.getElementById('feedback-positive');
        const negativeFeedbackButton = document.getElementById('feedback-negative');

        positiveFeebackButton.addEventListener('click', function() {
            resetFeedbackButtonActive();
            sendGaEvent(true);
            showMessage(true);
            positiveFeebackButton.classList.add('active');
        });

        negativeFeedbackButton.addEventListener('click', function() {
            resetFeedbackButtonActive();
            sendGaEvent(false);
            showMessage(false);
            negativeFeedbackButton.classList.add('active');
        });
    </script>

                        <div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="0.11-serialization.html">
                <button class="navigation__button">
                    <i class="icon-chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />Adjusting code to changes in serialization API introduced in 0.11
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="../logging/logging.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />Logging
                </div>
                <button class="navigation__button">
                    <i class="icon-chevron-right"></i>
                </button>
            </a>
        
    </div>
</div>
                        <!-- Post content text -->
                    </div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="icon-docs-menu-collapse"></i>
    </button>
    <div class="side-nav-content" style="visibility: hidden;">
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__title">
            <a href="https://rust-driver.docs.scylladb.com">Scylla Rust Driver</a>
        </div>
        <div class="side-nav__versions"><ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
    <li class="scylla-dropdown__item">
        <a class="scylla-dropdown__title" href="#">
            
                main
            
            <i class="chevron icon-docs-chevron-right"></i>
        </a>
        <ul class="menu scylla-dropdown__content">
            
                
                    <li>
                        <a href="0.15-deserialization.html">main</a>
                    </li>
                
            
            
                
                    <li>
                        <a href="../../stable/index.html">
                            v0.15.1
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="../../v0.14.0/index.html">
                            v0.14.0
                        </a>
                    </li>
                
            
        </ul>
    </li>
</ul></div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Scylla Rust Driver</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../quickstart/quickstart.html">Quick Start</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon-arrow-dropdown"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/create-project.html">Creating a project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/example.html">Connecting and running a simple query</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/scylla-docker.html">Running Scylla using Docker</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../connecting/connecting.html">Connecting to the cluster</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon-arrow-dropdown"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../connecting/compression.html">Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../connecting/authentication.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../connecting/tls.html">TLS</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../queries/queries.html">Making queries - best practices</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon-arrow-dropdown"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../queries/simple.html">Simple query</a></li>
<li class="toctree-l2"><a class="reference internal" href="../queries/values.html">Query values</a></li>
<li class="toctree-l2"><a class="reference internal" href="../queries/result.html">Query result</a></li>
<li class="toctree-l2"><a class="reference internal" href="../queries/prepared.html">Prepared query</a></li>
<li class="toctree-l2"><a class="reference internal" href="../queries/batch.html">Batch statement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../queries/paged.html">Paged query</a></li>
<li class="toctree-l2"><a class="reference internal" href="../queries/usekeyspace.html">USE keyspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../queries/schema-agreement.html">Schema agreement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../queries/lwt.html">Lightweight transaction (LWT) query</a></li>
<li class="toctree-l2"><a class="reference internal" href="../queries/timeouts.html">Query timeouts</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../execution-profiles/execution-profiles.html">Execution profiles</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon-arrow-dropdown"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../execution-profiles/create-and-use.html">Creating a profile and setting it</a></li>
<li class="toctree-l2"><a class="reference internal" href="../execution-profiles/maximal-example.html">All options supported by a profile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../execution-profiles/priority.html">Priorities of execution settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../execution-profiles/remap.html">Remapping execution profile handles</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../data-types/data-types.html">Data Types</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon-arrow-dropdown"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../data-types/primitive.html">Bool, Tinyint, Smallint, Int, Bigint, Float, Double</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-types/text.html">Ascii, Text, Varchar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-types/counter.html">Counter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-types/blob.html">Blob</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-types/inet.html">Inet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-types/uuid.html">Uuid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-types/timeuuid.html">Timeuuid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-types/date.html">Date</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-types/time.html">Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-types/timestamp.html">Timestamp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-types/duration.html">Duration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-types/decimal.html">Decimal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-types/varint.html">Varint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-types/collections.html">List, Set, Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-types/tuple.html">Tuple</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-types/udt.html">User defined types</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../load-balancing/load-balancing.html">Load balancing</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="icon-arrow-dropdown"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../load-balancing/default-policy.html">DefaultPolicy</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../retry-policy/retry-policy.html">Retry policy configuration</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="icon-arrow-dropdown"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../retry-policy/fallthrough.html">Fallthrough retry policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../retry-policy/default.html">Default retry policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../retry-policy/downgrading-consistency.html">Downgrading consistency retry policy</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../speculative-execution/speculative.html">Speculative execution</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label for="toctree-checkbox-8"><i class="icon-arrow-dropdown"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../speculative-execution/simple.html">Simple speculative execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../speculative-execution/percentile.html">Percentile speculative execution</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../metrics/metrics.html">Driver metrics</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="migration-guides.html">Migration guides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label for="toctree-checkbox-9"><i class="icon-arrow-dropdown"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="0.11-serialization.html">Adjusting code to changes in serialization API introduced in 0.11</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Adjusting code to changes in deserialization API introduced in 0.15</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../logging/logging.html">Logging</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tracing/tracing.html">Query tracing</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label for="toctree-checkbox-10"><i class="icon-arrow-dropdown"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../tracing/basic.html">Tracing a simple/prepared/batch query</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tracing/paged.html">Tracing a paged query</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tracing/prepare.html">Tracing <code class="docutils literal notranslate"><span class="pre">Session::prepare</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../tracing/query-history.html">Query Execution History</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../schema/schema.html">Schema</a></li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>
            
                <div class="sidebar-right large-order-3">
                    <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a href="https://github.com/scylladb/scylla-rust-driver/issues/new?title=docs:%20Issue on page Adjusting code to changes in deserialization API introduced in 0.15&&body=I%20would%20like%20to%20report%20an%20issue%20on%20page%20https://rust-driver.docs.scylladb.com/main/migration-guides/0.15-deserialization%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix&labels=documentation"
               target="_blank">
                <i class="icon-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                <a href="https://github.com/scylladb/scylla-rust-driver/edit/main/docs/source/migration-guides/0.15-deserialization.md"
                   target="_blank">
                    <i class="icon-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">Adjusting code to changes in deserialization API introduced in 0.15</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#old-traits">Old traits</a></li>
<li><a class="reference internal" href="#new-traits">New traits</a></li>
</ul>
</li>
<li><a class="reference internal" href="#updating-the-code-to-use-the-new-api">Updating the code to use the new API</a><ul>
<li><a class="reference internal" href="#basic-queries">Basic queries</a></li>
<li><a class="reference internal" href="#iterator-queries">Iterator queries</a></li>
<li><a class="reference internal" href="#procedural-macros">Procedural macros</a></li>
<li><a class="reference internal" href="#adjusting-custom-impls-of-deserialization-traits">Adjusting custom impls of deserialization traits</a></li>
</ul>
</li>
<li><a class="reference internal" href="#accessing-the-old-api">Accessing the old API</a></li>
<li><a class="reference internal" href="#mixing-the-old-and-the-new-api">Mixing the old and the new API</a></li>
</ul>
</li>
</ul>

        </div>
    
</div>
                </div>
            
        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com"></a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/" target="_blank">Docs</a>
                <a class="footer-links__link" href="https://university.scylladb.com/" target="_blank">University</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/"
                    target="_blank">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/" target="_blank">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <i class="icon-slack"></i>
                    </span>
                </a>
                <a class="footer-actions__link" href="https://forum.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="Community forum" data-position="bottom">
                        <i class="icon-docs-community"></i>
                    </span>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            
                <div class="footer-bottom__copyright">
                    
                        
                            &#169; 2024, ScyllaDB. All rights reserved.
                        
                    
                </div>
            
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 15 December 2024.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a href="http://sphinx-doc.org/">Sphinx 7.4.7</a> &amp;
                <a href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.8.3</a>
            </div>
        </div>
    </div>
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                    style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>